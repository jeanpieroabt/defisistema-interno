<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Defi Oracle - App</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body>
  <div id="toast-container" class="toast-container"></div>
  <div class="container">
    <nav class="navbar">
      <div class="brand">
        <img src="logo.png" alt="logo" />
        <span>Registro de Envíos</span>
      </div>
      <div class="user-menu">
        <button class="btn-menu" id="menuBtn"><span id="userLabel">Usuario</span> ▼</button>
        <div class="dropdown" id="menuDrop">
          <a id="adminLink" href="/admin.html" target="_blank" style="display:none">Administración</a>
          <a id="historicoLink" href="/historico.html" target="_blank">Histórico de Envíos</a>
          <hr/>
          <a href="/logout">Cerrar Sesión</a>
        </div>
      </div>
    </nav>

    <div class="content">
      <div id="kpiSaldoVes" class="kpi-ves" style="display: none;">
        <h3>SALDO VES ONLINE DISPONIBLE</h3>
        <strong id="kpiVesOnline">0,00 VES</strong>
      </div>

      <section id="kpisSection" style="display:none">
        <h2>Dashboard en Tiempo Real</h2>
        <div class="kpis-rates">
            <div class="kpi" style="background: #f0f8ff;">
                <div style="color:var(--muted)">Tasa Compra Promedio (VES/CLP)</div>
                <div id="kpiTasaCompra" style="font-weight:800; color:var(--primary)">—</div>
            </div>
            <div class="kpi" style="background: #f0f8ff;">
                <div style="color:var(--muted)">Tasa Venta Promedio HOY (VES/CLP)</div>
                <div id="kpiTasaVenta" style="font-weight:800; color:var(--primary)">—</div>
            </div>
        </div>
        <div class="kpis-grid">
          <div class="kpi"><div style="color:var(--muted)">Ganancia Bruta HOY (CLP)</div><div id="kpiG" style="font-weight:800">—</div></div>
          <div class="kpi"><div style="color:var(--muted)">Total Enviado HOY (CLP)</div><div id="kpiT" style="font-weight:800">—</div></div>
          <div class="kpi"><div style="color:var(--muted)">Margen Bruto HOY</div><div id="kpiM" style="font-weight:800">—</div></div>
        </div>
        <h3 style="margin-top: 15px;">Capital e Inventario</h3>
        <div class="kpis-grid">
          <div class="kpi" style="background: #eaf4ff;"><div class="kpi-h4">Capital Total (CLP)</div><div id="kpiCapitalTotal" style="font-weight:800">—</div></div>
          <div class="kpi"><div class="kpi-h4">Ganancia Acumulada (CLP)</div><div id="kpiGananciaAcumulada" style="font-weight:800">—</div></div>
          <div class="kpi">
            <div class="kpi-h4">Inventario VES (Valor en CLP)</div>
            <div id="kpiSaldoClpDisponible" style="font-weight:800">—</div>
          </div>
        </div>
      </section>

      <section id="operatorKpi" style="margin-bottom: 24px; display:none;">
        <h2 style="margin-bottom: 12px;">Tu Total Enviado (Este Mes)</h2>
        <div class="kpi" style="max-width:300px; margin: 0 auto; background:var(--secondary); color:var(--dark);">
            <div style="color:var(--dark); font-weight:700;">CLP Enviado Total Registrado</div>
            <div id="kpiOperatorClp" style="font-size:1.5rem; font-weight:900">0,00</div>
        </div>
      </section>

      <h2>Registrar Nuevo Envío</h2>
      <form id="frm">
        <div><label for="fch">Fecha del Envío</label><input type="date" id="fch" required></div>
        <div class="autocomplete-container">
          <label for="cli">Nombre del Cliente</label>
          <input type="text" id="cli" required autocomplete="off" />
          <div class="autocomplete-suggestions" id="clientSuggestions"></div>
        </div>
        <div><label for="mclp">Monto en CLP ($)</label><input type="number" id="mclp" required></div>
        <div><label for="tasa">Tasa</label><input type="number" id="tasa" step="0.0001" required></div>
        <div class="highlight">
          <div style="font-weight:700;color:var(--muted);margin-bottom:6px">Monto a recibir en VES (preview)</div>
          <div id="vesPreview" style="font-size:1.2rem;font-weight:800">0,00</div>
        </div>
        <div><label for="obs">Observaciones (opcional)</label><input type="text" id="obs"></div>
        <button class="btn btn-primary" type="submit">Guardar Envío</button>
      </form>

      <h2 id="tituloTabla">Envíos Registrados</h2>
      <table>
        <thead>
          <tr><th>Fecha</th><th>Operador</th><th>Cliente</th><th>Monto CLP</th><th>Tasa</th><th>Monto VES</th><th>Obs.</th><th>Acción</th></tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

  <div class="modal-overlay" id="editModal">
    <div class="modal-content">
      <h2>Editar Envío</h2>
      <form id="editForm" class="modal-form">
        <div class="form-grid">
          <div><label>Fecha</label><input type="date" id="editFecha" required></div>
          <div class="autocomplete-container">
            <label>Cliente</label>
            <input type="text" id="editCliente" required autocomplete="off">
            <div class="autocomplete-suggestions" id="editClientSuggestions"></div>
          </div>
          <div><label>Monto CLP</label><input type="number" id="editMontoClp" required></div>
          <div><label>Tasa</label><input type="number" id="editTasa" step="0.0001" required></div>
          <div class="form-full"><label>Observaciones</label><input type="text" id="editObs"></div>
        </div>
        <div class="modal-buttons">
          <button type="button" class="btn-light" id="cancelEdit">Cancelar</button>
          <button type="submit" class="btn-primary">Guardar Cambios</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // FUNCIÓN PARA MOSTRAR NOTIFICACIONES TOAST
    function showToast(message, type = 'info') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.textContent = message;
      container.appendChild(toast);

      setTimeout(() => toast.classList.add('show'), 100);

      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 500);
      }, 4000);
    }

    // ...rest of the script remains unchanged except alert->showToast changes...
  </script>
</body>
</html>