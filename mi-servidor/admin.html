<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Administración</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body>
  <div id="toast-container" class="toast-container"></div>
  <div class="card">
    <div class="hdr">
      <h1>Panel de Administración</h1>
      <div>
        <button class="btn-light" onclick="window.open('/historico.html','_blank')">Histórico</button>
        <button class="btn-primary" onclick="window.close()">Cerrar</button>
      </div>
    </div>
    <div class="content">
      <div class="kpis">
        <div class="kpi"><h4>Ganancia Bruta (CLP)</h4><strong id="kpi-ganancia">—</strong></div>
        <div class="kpi"><h4>Total Enviado (CLP)</h4><strong id="kpi-total">—</strong></div>
        <div class="kpi"><h4>Margen Bruto</h4><strong id="kpi-margen">—</strong></div>
      </div>
      
      <div class="box">
        <h3>Capital CLP Inicial</h3>
        <p style="color:var(--muted); font-size:.85rem; margin-bottom: 12px;">Establece el monto de la inversión inicial en CLP (moneda base). El saldo de VES inicia en cero.</p>
        <form id="fCapital">
          <div class="grid3" style="grid-template-columns: 1fr;">
              <div><label>Capital CLP Inicial</label><input type="number" step="0.01" name="capitalInicialClp" id="iCapClp" required></div>
          </div>
          <div style="margin-top:10px"><button class="btn">Guardar Capital Inicial</button></div>
        </form>
      </div>
      <div class="box" style="margin-top:16px">
        <h3>Tasas de Venta Automáticas</h3>
        <div class="grid3">
          <div><label>&ge; 5.000 CLP</label><input type="number" step="0.001" id="t1"></div>
          <div><label>&ge; 100.000 CLP</label><input type="number" step="0.001" id="t2"></div>
          <div><label>&ge; 250.000 CLP</label><input type="number" step="0.001" id="t3"></div>
        </div>
        <div style="margin-top:10px"><button id="saveTasas" class="btn">Guardar Tasas</button></div>
      </div>

      <div class="grid2" style="margin-top:16px">
        <div class="box">
          <h3>Comprar VES (con CLP)</h3>
          <form id="fCompras">
            <label>CLP Invertidos</label><input type="number" step="0.01" name="clp_invertido" required>
            <label>VES Obtenidos</label><input type="number" step="0.01" name="ves_obtenido" required>
            <div style="margin-top:10px"><button class="btn">Registrar Compra</button></div>
          </form>
        </div>
        
        <div class="box">
          <h3>Gestionar Operadores</h3>
          <form id="fOper">
            <label>Usuario</label><input type="text" name="username" required>
            <label>Contraseña</label><input type="password" name="password" required>
            <div style="margin-top:10px"><button class="btn">Crear Operador</button></div>
          </form>
        </div>
      </div>
      
      <div class="box full-width-table" style="margin-top:16px">
          <h3>Editar Usuarios Existentes</h3>
          <table class="table">
              <thead>
                  <tr>
                      <th>ID</th>
                      <th>Usuario</th>
                      <th>Rol</th>
                      <th>Acción</th>
                  </tr>
              </thead>
              <tbody id="tbodyUsuarios">
                  </tbody>
          </table>
      </div>

      <div class="box full-width-table" style="margin-top:16px">
          <h3>Historial de Compras (Edición)</h3>
          <table class="table">
              <thead>
                  <tr>
                      <th>ID</th>
                      <th>Fecha</th>
                      <th>CLP Invertido</th>
                      <th>VES Obtenidos</th>
                      <th>Tasa (VES/CLP)</th>
                      <th>Acción</th>
                  </tr>
              </thead>
              <tbody id="tbodyCompras">
                  </tbody>
          </table>
      </div>

    </div>
  </div>

  <script>
    // FUNCIÓN PARA MOSTRAR NOTIFICACIONES TOAST
    function showToast(message, type = 'info') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.textContent = message;
      container.appendChild(toast);

      setTimeout(() => toast.classList.add('show'), 100);

      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 500);
      }, 4000);
    }

    // ...rest of the script remains unchanged except alert->showToast changes...
  </script>
</body>
</html>
